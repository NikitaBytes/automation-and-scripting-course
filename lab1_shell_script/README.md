# ЛАБОРАТОРНАЯ РАБОТА №1

Автоматизация резервного копирования каталога (Shell, Linux)

---

## Студент

- **Имя и фамилия**: Савка Никита (Savca Nichita)
- **Группа**: I2302
- **Платформа разработки**: macOS (Apple M3), запуск из терминала
- **Среда исполнения**: Linux-сервер (GNU userland; Bash, coreutils, tar, gzip)
- **Дата выполнения**: 14 сентября 2025

---

## Цель и постановка задачи

**Цель:** освоить практическое создание и запуск простого Shell-скрипта для автоматизации рутинной задачи — резервного копирования каталога в Linux.

**Задача:** написать скрипт `backup.sh`, принимающий путь к исходному каталогу и опционально путь каталога для хранения бэкапов (по умолчанию `/backup`); формировать архив `tar.gz` с текущей датой/временем в имени; проверять существование директорий и выдавать понятные ошибки.

---

## Краткое описание решения

Реализован скрипт `backup.sh`, который:

- нормализует и валидирует пути (`readlink -f`),
- создаёт каталог назначения при отсутствии,
- формирует архив `tar.gz` с меткой времени `YYYY-MM-DD_HH-MM-SS`,
- защищается от «битых» файлов через временный `.part` и `trap` на ERR/INT/TERM,
- исключает из архива каталог назначения, если он находится внутри исходного (анти-рекурсия),
- проверяет целостность архива (`gzip -t`), выводит размер (`du -h`) и SHA-256 (если доступно `sha256sum`),
- пишет структурированные логи с меткой времени.

---

## Структура репозитория (фрагмент)

```
automation-and-scripting-course/
└─ lab1_shell_script/
   ├─ backup.sh
   └─ icons/ (тестовые данные для бэкапа)
```

---

## Исходный код скрипта в файйле `backup.sh` (готов к использованию на Linux)

---

## Инструкция по запуску

1. Сделать скрипт исполняемым:

```bash
chmod +x backup.sh
```

2. Запуск с каталогом назначения по умолчанию (/backup):

```bash
./backup.sh ./icons
```

3. Запуск с явным каталогом назначения:

```bash
./backup.sh ./icons /mnt/backups
```

Требования: права на запись в DEST; наличие утилит `tar`, `gzip`, `readlink` (coreutils).

---

## Примеры вывода

```
[2025-09-13 22:40:20] Destination does not exist; creating: /backup
[2025-09-13 22:40:20] Creating archive: /backup/icons-2025-09-13_22-40-20.tar.gz
[2025-09-13 22:40:20] SHA256: a0869d2e...
[2025-09-13 22:40:20] Size: 110
[2025-09-13 22:40:20] Backup completed successfully.
[2025-09-13 22:40:20] Archive: /backup/icons-2025-09-13_22-40-20.tar.gz
```

---

## Разбор ключевых решений (кратко)

- set -Eeuo pipefail и настройка IFS — защита от неожиданных ошибок и безопасная работа с пробелами в именах файлов.
- Нормализация путей (`readlink -f`) — корректные сравнения и исключения.
- Временный `.part` и `trap` — предотвращение остаточных «битых» файлов.
- Исключение каталога назначения при вложенности — предотвращение рекурсивного добавления архива в сам себя.
- Проверки целостности и вывод SHA256 — подтверждение корректности артефакта.

---

## Ссылки и материалы

- GNU tar — руководство пользователя: https://www.gnu.org/software/tar/manual/tar.html
- gzip — руководство: https://www.gnu.org/software/gzip/manual/gzip.html
- find (man): https://man7.org/linux/man-pages/man1/find.1.html
- crontab (man): https://man7.org/linux/man-pages/man5/crontab.5.html
- GNU coreutils (readlink, sha256sum и др.): https://www.gnu.org/software/coreutils/manual/coreutils.html
- readlink (man): https://man7.org/linux/man-pages/man1/readlink.1.html
- du (man): https://man7.org/linux/man-pages/man1/du.1.html
- sha256sum (man): https://man7.org/linux/man-pages/man1/sha256sum.1.html
- GNU Bash — руководство: https://www.gnu.org/software/bash/manual/bash.html

Полезные практики (кратко)

- Исключение каталога назначения предотвращает рекурсивную упаковку и появление архива в себе же.
- Временный файл `.part` + `trap` гарантируют отсутствие «битых» артефактов при прерывании процесса.
- Проверка gzip (`gzip -t`) и контрольная сумма (`sha256sum`) повышают уверенность в целостности бекапа.
- Создание архива из родительского каталога (`tar -C parent ... base`) даёт относительные пути внутри архива — удобнее при восстановлении.

---

## Выводы

1. Реализован надёжный скрипт резервного копирования для Linux с нормализацией путей, анти-рекурсией и атомичным созданием архива.
2. Добавлены практики продакшн-качества: временный `.part`, `trap`, проверка целостности и вывод SHA-256.
3. Скрипт готов к интеграции в cron и подходит для регулярного бэкапа конфигураций и статических данных.
